import{e as u}from"./apiError-CV8dFrwn.js";function I(e){const o=e.getFullYear(),t=String(e.getMonth()+1).padStart(2,"0"),s=String(e.getDate()).padStart(2,"0");return`${o}-${t}-${s}`}function k(e){const o=Object.values(e.allFitData);if(o.length===0)return{...e,aggregate:{}};const t=new Date,s=new Date(t.getTime()-7*24*60*60*1e3),m=new Date(t.getTime()-14*24*60*60*1e3);new Date(t.getTime()-30*24*60*60*1e3);const g=t.getMonth(),c=t.getFullYear(),C=g===0?11:g-1,A=g===0?c-1:c,Z=(n,r)=>o.filter(a=>{const i=new Date(a.DateRecorded);return i>=n&&i<=r}),f=(n,r)=>o.filter(a=>{const i=new Date(a.DateRecorded);return i.getMonth()===n&&i.getFullYear()===r}),h=(n,r=n.length)=>{if(n.length===0)return null;const a=n.reduce((i,l)=>({Zone1Time:i.Zone1Time+(l.Zone1Time||0),Zone2Time:i.Zone2Time+(l.Zone2Time||0),Zone3Time:i.Zone3Time+(l.Zone3Time||0),Zone4Time:i.Zone4Time+(l.Zone4Time||0),Zone5Time:i.Zone5Time+(l.Zone5Time||0),resting_heart:i.resting_heart+(l.resting_heart||0),totalZoneTime:i.totalZoneTime+(l.totalZoneTime||0),weight:i.weight+parseFloat(l.weight||0),calories:i.calories+R(l)}),{Zone1Time:0,Zone2Time:0,Zone3Time:0,Zone4Time:0,Zone5Time:0,resting_heart:0,totalZoneTime:0,weight:0,calories:0});return{avgZone1Time:(a.Zone1Time/r).toFixed(2),avgZone2Time:(a.Zone2Time/r).toFixed(2),avgZone3Time:(a.Zone3Time/r).toFixed(2),avgZone4Time:(a.Zone4Time/r).toFixed(2),avgZone5Time:(a.Zone5Time/r).toFixed(2),avgRestingHeart:(a.resting_heart/n.length).toFixed(2),avgTotalZoneTime:(a.totalZoneTime/r).toFixed(2),avgWeight:(a.weight/n.length).toFixed(2),avgCalories:(a.calories/r).toFixed(2)}},T=(n,r)=>{if(!n||!r)return null;const a=(i,l)=>l===0?0:((i-l)/l*100).toFixed(2);return{caloriesChange:a(parseFloat(n.avgCalories),parseFloat(r.avgCalories)),weightChange:a(parseFloat(n.avgWeight),parseFloat(r.avgWeight)),heartRateChange:a(parseFloat(n.avgRestingHeart),parseFloat(r.avgRestingHeart))}},b=Z(s,t),M=Z(m,s),Y=f(g,c),S=f(C,A),x=o.filter(n=>new Date(n.DateRecorded).getFullYear()===c),y=o.filter(n=>new Date(n.DateRecorded).getFullYear()===c-1),w=h(b,7),d=h(M,7),D=h(Y,30),F=h(S,30),p=h(x,365),v=h(y,365),W={currentWeek:{...w,...T(w,d)},lastWeek:d,currentMonth:{...D,...T(D,F)},lastMonth:F,currentYear:{...p,...T(p,v)},lastYear:v};return{...e,aggregate:W}}function R(e){let o=0;return o+=(e.Zone1Time||0)*4+(e.Zone2Time||0)*6+(e.Zone3Time||0)*8.5+(e.Zone4Time||0)*12.5+(e.Zone5Time||0)*17.5,o}async function P(){const e=new AbortController,o=setTimeout(()=>e.abort(),1e4);try{const t=await fetch("http://localhost:3000/api/getSharedData",{signal:e.signal});return clearTimeout(o),await u(t)}catch(t){return clearTimeout(o),t}}async function _(){const e=new AbortController,o=setTimeout(()=>e.abort(),1e4);try{const t=await fetch("http://localhost:3000/api/getFitData",{signal:e.signal,credentials:"include"});clearTimeout(o);let s=await u(t);return k(s)}catch(t){console.error("Error:",t)}}async function E(e,o,t){const s=new AbortController,m=setTimeout(()=>s.abort(),1e4),g={method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",signal:s.signal,body:JSON.stringify({DataName:e,Data:o,Date:t})};try{const c=await fetch("http://localhost:3000/api/updateDataPage",g);return clearTimeout(m),await u(c)}catch(c){console.error("Error:",c)}}async function B(){const e=new AbortController,o=setTimeout(()=>e.abort(),1e4);try{const t=await fetch("http://localhost:3000/api/getShareInfo",{signal:e.signal,credentials:"include"});return clearTimeout(o),await u(t)}catch(t){console.error("Error:",t)}}async function H(){const e=new AbortController,o=setTimeout(()=>e.abort(),1e4);try{const t=await fetch("http://localhost:3000/api/updateShare",{method:"PUT",credentials:"include",signal:e.signal});return clearTimeout(o),await u(t)}catch(t){console.error("Error:",t)}}export{I as a,P as b,_ as f,B as g,E as s,H as u};
